{"componentChunkName":"component---src-templates-blog-post-js","path":"/develop/mall-fashion/mall4/","result":{"data":{"site":{"siteMetadata":{"title":"Godo dev"}},"markdownRemark":{"id":"5be3e384-1619-5aa7-b5fd-3c1f71d99da9","excerpt":"도입 배경 현재 프로젝트는 부하테스트 등 QA(Quality Analysis…","html":"<h2>도입 배경</h2>\n<p>현재 프로젝트는 부하테스트 등 QA(Quality Analysis)를 위해서 로컬 환경에서 도커 이미지를 빌드한 후에 원격 호스트에서 해당 도커이미지를 수동으로 실행하는 방법을 사용하고 있습니다. 이 방법은 언뜻 보기에는 불편해보이지 않지만 잘못된 이미지를 실행하는 등 가끔 실수를 유발하기도 하고 컨테이너가 정상적으로 삭제가 되지 않아 충돌이 발생해 개발자가 ec2 콘솔에 접속해야하는 등 시간을 소모하고 일관되지 않은 결과를 유발합니다.</p>\n<p>이는 특히 여러명이 협업하는 상황에서 혼란은 가중시키며 가장 큰 문제점은 배포 프로세스가 일관되지 않고 불안정하다는 것입니다. 무엇보다 이러한 프로세스는 귀찮기 때문에 develop의 내용을 출시를 위해 release 브랜치로 병합할 때 QA 서버로 자동 배포가 가능하게끔 구현하면 이러한 문제를 해결할 수 있을 것입니다. 이때 사용되는 개념이 Continuous Delivery인데 이에 대해 먼저 다루고 프로젝트에서 Continuous Delivery를 어떻게 구현했는지 다뤄보고자 합니다.</p>\n<p>그리고 이번 포스트의 내용은 이전 포스트의 내용과 이어집니다. Continuous Delivery는 CI의 연장선 상의 개념이기 때문입니다.</p>\n<p><a href=\"mall3.md\">지속적인 통합 - Github Action을 통한 안정적인 통합 환경 구축</a></p>\n<h2>CD(Continuous Delivery / Continuous Deployment)</h2>\n<p><img src=\"https://www.redhat.com/rhdc/managed-files/styles/wysiwyg_full_width/private/ci-cd-flow-desktop.png.webp?itok=mDEvsSsp\" alt=\"ci-cd\"></p>\n<p>CI/CD의 \"CD\"는 지속적 제공(Continuous Delivery) 및/또는 지속적 배포(Continuous Deployment)를 의미하며 이 두 용어는 상호 교환하여 사용됩니다. 두 가지 모두 파이프라인의 추가 단계를 자동화하는 것이지만 자동화가 얼마나 많이 진행되고 있는지를 나타내기 위해 별도로 사용될 수도 있습니다. 지속적 제공과 지속적 배포 중 어느 것을 선택할지는 개발 팀과 운영 팀의 위험 허용 범위와 구체적인 요구 사항에 따라 달라집니다.</p>\n<h3>Continuous Delivery</h3>\n<p>Continuous Delivery는 CI로 검증된 코드를 리포지토리로 릴리스하는 것을 자동화합니다.\nContinuous Delivery의 목표는 언제나 프로덕션 환경으로 배포할 준비가 되어 있는 코드베이스를 갖추고 새로운 코드를 배포하는 데 필요한 노력을 최소화하는 것입니다.</p>\n<h3>Continuous Deployment</h3>\n<p>개발자의 변경사항이 prod 레벨까지 지속적으로 release 되어 고객이 사용할 수 있게 되는 것을 의미합니다. CD는 애플리케이션 제공 속도를 저하시키는 수동 프로세스로 인한 운영 팀의 업무 과다 문제를 해결합니다. 지속적 배포는 파이프라인의 다음 단계를 자동화함으로써 지속적 제공의 장점을 활용합니다. 이러한 CI/CD 파이프라인은 애플리케이션 배포의 리스크를 줄여주므로 애플리케이션 변경 사항을 한꺼번에 릴리스하지 않고 작은 단위로 세분화하여 더욱 손쉽게 릴리스할 수 있습니다.</p>\n<p>그러나 프로덕션 이전의 파이프라인 단계에는 수동 게이트가 없으므로 지속적 배포는 잘 설계된 테스트 자동화에 크게 의존합니다. 따라서 CI/CD 파이프라인에서 다양한 테스트 및 릴리스 단계를 수용하기 위해 자동화된 테스트를 작성해야 하므로 지속적 배포에는 많은 선행 투자가 필요합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bd05251ae21a56ab861b24182f5d4a31/97bfd/mall4-cd-concept.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 112.0253164556962%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAABYlAAAWJQFJUiTwAAAFa0lEQVR42mWV63NU5R3H95+p44z6wrHDEAWS3Zxz9pYEFQIoghARvIxKyyha8qK0altCrDECAgGVYDCE3LObTbL37J49e/a+2Ws2iC3j2Mu0M211ptM3n/7O+sIXvvjO85zn+f5+53d/bMp6CiWuo/hDqMshOucDOOaWcSyu4pBvbTksd0EcviDdq1EcS6uo8m33raFYnBkfDpHRRE93TMem6mZboXPsFj0C9Y9jbWgXb6Be+BzvJzfpvTSOR1b1+iS9H3/OHoFqncvq+eAqnqsTuFMZlIQhCs0sajaPq1jGW97AUxJUam14N6p4a3WUaBJFrPPWG3jKFfqqcmfxZO/dqOAWOSWTQzUy2BxCdH42hSJ/3DEsfxMrusUi7apYe3Ec9coEmpwpE7Mow1fwXP6i/e0Ym0C5KBYKp+v8FTSRcQbC2DTL5bUY2kqErqU1tEgCVX6iBCIocuaRu97QOj3xFL0SZ7dY2y2CangdNRTHLdxuiaUWjOGyLHSLqwfyRQ6JewP1JkfFxYFGk+drDQ5v1OgTt9ytFk6575MwPC8YaG4Kr8HRaoMjslpyz4oeLVfAtlO0rlRb/PubbwmHk6zHDJb8YSqlGt//7R8cNgs88u4oDw2e55CZR9fzLC9HMY080UgKfyCKHjW4k8rTLXG0KdkCH+XLTDXuM5So8EGy2sZY6WsWN7/mmUyBjtuL7JRwHMjk+dQsM5KqM6LXGU03GU5UuZpp8GGm2E6uradeo7NQ5b3QEMv6L5nTT7NgnOZW8CRPpiNozS36vrpL7927uKx9Os5k/DTz+lvMCtcnMudDv8O+UcdTrYrCZh17sUlUPwa17dTmNP6TdvC/TAfHTD9q60/01KRMBM7WPQ4mA/y32MV3hr3NpdpBMn4QpbIlZVXH5m006C43uBw8Sy5+lGDwOMnYCSIrAxzMRNpKeqT+LLhbX7HXiBIJnSAZfZGQcDOxAa4FfoVa22zXqc0jWbU2nZt/ZtvWX9gdLdGRa/H4vb+2XextNvFsttqw9m452771LfbafTzBHD9vfkNX6/4PRW8ptDpBq9Q5NX2Z0YmzXLg2yMjNs/xh/LfsMVPYmy0pnQ36pDMcjU2eMg1+P/G+cH/Dx2NnGPniLG/dvoBTSscjYRGFVXaVGsRH9/LPMw9gvr2NxuBj/GvwZxwJz/NK8x5TsTTzySwna1v0ry7y3bsPU3vnUbLvbOPvZx5EP+/FXt38ISneSkWSUuPWJy/RGLITGurBHPaQPaewO7zEjUKDWCLDWtxkutSkLxQg86EHc8jFunBr5+xMjR6luyIWSl/bXOKKW6CkC2jhOKdmltjjj/LyzQXe9oUZl0Kfiqa5LcV7yRfh1PwaJ7/083QgTv+0jLp1Ey2Vwy3KXBIam6tYQpPCPpD0cUyf4Ncr1zkZvMGbc5c5HgrzWrnGa6UKr5erHM+VGFgNMei7zqvRm7ziv8YLxiTPJBbQihtYumyufAG7UWQk9AYriV7uJPuluPuZjuxmX3aZHZVNHKUydkGXlMbu1ApTiX4WEntYSO1jOdbLpeAJlJwoFF02p7RLVzLHuZVfMBt6itvh/UzH9jPhe5Jnk4uokjBPoYhboEl/Px3xMRncz2RoH1MR4YrMsP9V6WPx1OplzTBRpen3SgccMWY5lJjhsD7Lc+szuA0DZ76EU6ZIG7J3pQwOJmaFM8MhfU5k5uhf90kfSw7SWWw7JufZLsOy40sf22flrchsYJcBYK2aDANNJrpm5n6EnDksTrbCzojB44tRdkoSOxdWcMhMtO2aC7BDpskT43fk4ZFBmUwJDDTdQNXTqCnzJ7DuneKZ3b9G56wPuzxmu+Rh6/IH+T+UweT0plMHOAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cd-concept\"\n        title=\"\"\n        src=\"/static/bd05251ae21a56ab861b24182f5d4a31/f058b/mall4-cd-concept.png\"\n        srcset=\"/static/bd05251ae21a56ab861b24182f5d4a31/c26ae/mall4-cd-concept.png 158w,\n/static/bd05251ae21a56ab861b24182f5d4a31/6bdcf/mall4-cd-concept.png 315w,\n/static/bd05251ae21a56ab861b24182f5d4a31/f058b/mall4-cd-concept.png 630w,\n/static/bd05251ae21a56ab861b24182f5d4a31/40601/mall4-cd-concept.png 945w,\n/static/bd05251ae21a56ab861b24182f5d4a31/97bfd/mall4-cd-concept.png 1078w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Continuous Deployment 대신 Continuous Delivery을 사용하는 이유</h2>\n<p>현재 프로젝트는 다음과 같은 과정을 거쳐 사용자에게 서비스됩니다.</p>\n<blockquote>\n<ol>\n<li>feature 브랜치에서 기능 구현 후 develop 브랜치에 병합</li>\n<li>버전 내 릴리즈할 기능의 구현이 모두 완료되면 release 브랜치 생성</li>\n<li>release 브랜치를 QA 서버에 배포 후 QA</li>\n<li>QA 중 버그를 수정한 후 출시</li>\n</ol>\n</blockquote>\n<p>현재 3번의 QA 과정을 거쳐야 하는 프로젝트 특성상 QA 이후 매뉴얼하게 배포를 하는 방식을 사용해야 하기 때문에 1번부터 4번까지의 자동화된 프로세스를 의미하는 Continuous Deployment 대신 Continuous Delivery를 사용하고 있습니다.</p>\n<p>그래서 이번 포스트에서는 Continuous Delivery의 영역인 2번과 3번을 Github Action을 통해 자동화하는 과정에 대해 다뤄보고자 합니다.</p>\n<h2>Github Actions을 통해 구현한 Continuous Delivery</h2>\n<p>release 브랜치에 push 이벤트가 발생했을 때 CI와 QA 서버로의 배포 자동화를 qa-deploy.yml이라는 파일에 정의했습니다. 아래는 해당 파일의 전체입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Automized Deployment to QA server\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>release<span class=\"token punctuation\">-</span>*<span class=\"token punctuation\">]</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v3\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up JDK 17\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>java@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">java-version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"17\"</span>\n          <span class=\"token key atrule\">distribution</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"temurin\"</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Grant execute permission for gradlew\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> chmod +x gradlew\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and test with Gradle\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> ./gradlew clean build\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up Docker Buildx\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/setup<span class=\"token punctuation\">-</span>buildx<span class=\"token punctuation\">-</span>action@v2\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Log in to Docker Hub\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/login<span class=\"token punctuation\">-</span>action@v2\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DOCKER_HUB_USERNAME <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DOCKER_HUB_PASSWORD <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and push Docker image\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/build<span class=\"token punctuation\">-</span>push<span class=\"token punctuation\">-</span>action@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">context</span><span class=\"token punctuation\">:</span> .\n          <span class=\"token key atrule\">file</span><span class=\"token punctuation\">:</span> Dockerfile\n          <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n          <span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span> wedowhatwedo/mall<span class=\"token punctuation\">-</span>qa<span class=\"token punctuation\">:</span>latest\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Deploy\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> appleboy/ssh<span class=\"token punctuation\">-</span>action@master\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.EC2_HOST <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.EC2_USER <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.EC2_SSH_KEY <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.EC2_SSH_PORT <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n            sudo docker pull wedowhatwedo/mall-qa:latest\n            sudo docker stop backend || true\n            sudo docker rm backend || true\n            sudo docker run --rm -d --name backend -p 8080:8080 wedowhatwedo/mall-qa:latest</span></code></pre></div>\n<p>이제 부분부분에 대해서 설명해보겠습니다.</p>\n<h3>1. 워크플로우 이름 및 실행 조건</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Automized Deployment to QA server\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>release<span class=\"token punctuation\">-</span>*<span class=\"token punctuation\">]</span></code></pre></div>\n<ul>\n<li>name은 워크플로우 이름을 지칭합니다.</li>\n<li>on절은 <code class=\"language-text\">release-</code>로 시작하는 브랜치에 대해서 push 이벤트가 발생했을 때 워크플로우가 실행될 것을 의미합니다.</li>\n</ul>\n<h3>2. 잡 정의</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest</code></pre></div>\n<ul>\n<li>잡 이름을 deploy로 지칭합니다.</li>\n<li><code class=\"language-text\">runs-on</code>을 통해 실행 환경을 지정합니다.</li>\n<li>ubuntu-latest는 최신 우분투 환경에서 실행함을 의미합니다.</li>\n</ul>\n<h3>3. 잡 정의</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest</code></pre></div>\n<ul>\n<li>잡 이름을 deploy로 지칭합니다.</li>\n<li><code class=\"language-text\">runs-on</code>을 통해 실행 환경을 지정합니다.</li>\n<li>ubuntu-latest는 최신 우분투 환경에서 실행함을 의미합니다.</li>\n</ul>\n<h3>4. 단계별 정의</h3>\n<h4>1. 빌드</h4>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout\n  <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v3\n\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up JDK 17\n  <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>java@v3\n  <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">java-version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"17\"</span>\n    <span class=\"token key atrule\">distribution</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"temurin\"</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Grant execute permission for gradlew\n  <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> chmod +x gradlew\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and test with Gradle\n  <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> ./gradlew clean build</code></pre></div>\n<p>빌드와 관련된 스크립트입니다. 해당 부분에 대한 자세한 설명은 건너뛰고 배포 자동화에 대한 부분만 살펴보려 합니다. 자세한 내용은 <a href=\"mall3.md\">이전 포스트</a>에서 확인 가능합니다.</p>\n<h4>2. 도커 이미지 빌드&#x26;푸시</h4>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up Docker Buildx\n  <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/setup<span class=\"token punctuation\">-</span>buildx<span class=\"token punctuation\">-</span>action@v2\n\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Log in to Docker Hub\n  <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/login<span class=\"token punctuation\">-</span>action@v2\n  <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DOCKER_HUB_USERNAME <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DOCKER_HUB_PASSWORD <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and push Docker image\n  <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/build<span class=\"token punctuation\">-</span>push<span class=\"token punctuation\">-</span>action@v3\n  <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">context</span><span class=\"token punctuation\">:</span> .\n    <span class=\"token key atrule\">file</span><span class=\"token punctuation\">:</span> Dockerfile\n    <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span> wedowhatwedo/mall<span class=\"token punctuation\">-</span>qa<span class=\"token punctuation\">:</span>latest</code></pre></div>\n<ul>\n<li>멀티플랫폼 이미지 빌드를 지원하는 Docker Buildx를 설정합니다.</li>\n<li>Docker Hub에 로그인하여 이미지를 푸시할 수 있도록 설정합니다.</li>\n<li>GitHub Secrets에서 가져온 사용자 이름과 비밀번호를 사용합니다.</li>\n<li>도커 이미지를 빌드하고 Docker Hub에 푸시합니다.\n<ul>\n<li>context: 현재 디렉토리를 빌드 컨텍스트로 사용</li>\n<li>file: 사용할 Dockerfile</li>\n<li>push: 빌드 후 이미지를 Docker Hub에 푸시</li>\n<li>tags: 푸시할 이미지에 적용할 태그</li>\n</ul>\n</li>\n</ul>\n<h4>3. 원격 호스트에 접속 후 배포 스크립트 실행</h4>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Deploy\n  <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> appleboy/ssh<span class=\"token punctuation\">-</span>action@master\n  <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.EC2_HOST <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.EC2_USER <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.EC2_SSH_KEY <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.EC2_SSH_PORT <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n      sudo docker pull wedowhatwedo/mall-qa:latest\n      sudo docker stop backend || true\n      sudo docker rm backend || true\n      sudo docker run --rm -d --name backend -p 8080:8080 wedowhatwedo/mall-qa:latest</span></code></pre></div>\n<p><code class=\"language-text\">appleboy/ssh-action</code>은 SSH를 사용하여 원격 서버에 명령을 실행할 수 있게 해주는 오픈소스 액션입니다. 이를 사용하면 워크플로우에서 직접 원격 서버로 연결해 다양한 작업을 자동화할 수 있습니다. 이는 배포, 서버 구성, 스크립트 실행 등 원격 서버에서 수행해야 하는 작업에 유용합니다.</p>\n<p>손쉽게 SSH 접속에 필요한 정보들을 AWS secrets에 저장한 환경변수를 통해 설정하고 스크립트를 실행함으로써 배포를 실행할 수 있었습니다.</p>\n<h2>결론</h2>\n<p>아래와 같이 release 브랜치 생성과 함께 QA서버 배포를 자동화할 수 있었습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4b7b69f5965210cf652d9d8cf6b0edbb/2cefc/mall4-result2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABFklEQVR42qVS2U7DMBD0//8eEqgSlMMkKZS0OVrfzjDrJlJ4JH2YeL3rjGd2rWJKMNbBOQ/vAyxX6xxSzpgATFP5FkicCcdzKd3qy144hEvF6FE3n9C6IjSqqi7o+h591+E0GuhhwluX0BqhAKq6wfuHRualgpf9K76+j6WmJBFTRIhEiFR5U+rn2HE1IcP4DB+piuclb6ylylQILdXJvzlPUMZ6tOcBP6cO536EcbTt4x+IJTtjXZd42Zt5r7rhgofHHZ52z9BVgysvWA5ugRJ2HxJtT7SUCuE9pMpwqu3IAVCpYyKQXODEwgZidWFD90fNSR9I4sszkEZL34bLdZtlUSQTNC7SbiiQeN34fxCGu/u2JvwF9ZUKPc1Q5JIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"result2\"\n        title=\"\"\n        src=\"/static/4b7b69f5965210cf652d9d8cf6b0edbb/f058b/mall4-result2.png\"\n        srcset=\"/static/4b7b69f5965210cf652d9d8cf6b0edbb/c26ae/mall4-result2.png 158w,\n/static/4b7b69f5965210cf652d9d8cf6b0edbb/6bdcf/mall4-result2.png 315w,\n/static/4b7b69f5965210cf652d9d8cf6b0edbb/f058b/mall4-result2.png 630w,\n/static/4b7b69f5965210cf652d9d8cf6b0edbb/40601/mall4-result2.png 945w,\n/static/4b7b69f5965210cf652d9d8cf6b0edbb/78612/mall4-result2.png 1260w,\n/static/4b7b69f5965210cf652d9d8cf6b0edbb/2cefc/mall4-result2.png 1400w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/02692624c964936a4ee900004b3b6932/b490f/mall4-result1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.316455696202528%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAABEUlEQVR42k1Q226CQBDlp3mpSf2B+j/lyfpoGm1SLHIRXHCRO4iQAAE57Uxi0kkme/bs7JwzoziRBeP6A+3jHau3FVRVxXb7ib7vUVUV7vc7mqZhLISA53l4xjRNGMcRt9sNdV3D9wModVHjdHThmA4ejwc/nE4OoihCUZQoyxJ5nmMYBsZpmkJKyZzv+yxAPAm6f1gxwyPc3IG20bB8XWKxeMF6veFiXf+GYRgwTRNhGMKyLL4/G7Zty81oAjIjhA8lzmOIUGD3teOP+/0ecZwgyzJ2Nc8zF1MmScLO/0fXdTifzyxApxJdI8iLhOd6TAaXADKUOOgH2LbNSULkitYRBAG7pKSdkjCNXRQFLNvBL/0tbJppOqFwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"result1\"\n        title=\"\"\n        src=\"/static/02692624c964936a4ee900004b3b6932/f058b/mall4-result1.png\"\n        srcset=\"/static/02692624c964936a4ee900004b3b6932/c26ae/mall4-result1.png 158w,\n/static/02692624c964936a4ee900004b3b6932/6bdcf/mall4-result1.png 315w,\n/static/02692624c964936a4ee900004b3b6932/f058b/mall4-result1.png 630w,\n/static/02692624c964936a4ee900004b3b6932/40601/mall4-result1.png 945w,\n/static/02692624c964936a4ee900004b3b6932/b490f/mall4-result1.png 1142w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이로써 프로젝트에서 더 이상 개발자가 QA를 위해서 번거롭게 로컬 환경에서 이미지를 빌드하고 원격 서버에 접속하여 수동으로 도커 이미지를 실행하는 번거로움과 혼선을 줄일 수 있게 되었습니다. 이를 통해 개발자는 좀 더 편하게 QA를 할 수 있는 환경이 주어질 뿐만 아니라 핵심적인 비즈니스 로직 구현에 집중할 수 있게 되었습니다.</p>\n<p>또한 Jenkins 가 아닌 Github Actions을 이용함으로써 서버 비용 또한 줄일 수 있었으며 환경 설정의 편의를 얻을 수 있었습니다. 이 주제는 추후에 프로젝트의 복잡성이 증가함에 따라서 멀티모듈 혹은 MSA를 도입하게 되면 다시 다뤄볼만한 주제인 것 같습니다. 그때는 또 다른 상황이니까요.\n긴 글 읽어주셔서 감사합니다!</p>\n<h2>참고 자료</h2>\n<ul>\n<li><a href=\"https://www.redhat.com/ko/topics/devops/what-is-ci-cd\">CI/CD란?</a></li>\n<li><a href=\"https://techblog.woowahan.com/2553/\">release 브랜치에 관한 이야기</a></li>\n</ul>","frontmatter":{"title":"Continuous Delivery - 자동화된 QA 환경 구축","date":"August 28, 2024","description":"개인 프로젝트 mall-fashion 개선기 #4"}},"previous":{"fields":{"slug":"/develop/mall-fashion/mall3/"},"frontmatter":{"title":"지속적인 통합 - Github Actions을 통한 안정적인 통합 환경 구축"}},"next":null},"pageContext":{"id":"5be3e384-1619-5aa7-b5fd-3c1f71d99da9","previousPostId":"def7a832-cd12-5dc5-acc1-b6fec414d568","nextPostId":null}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}